<!DOCTYPE html>
<!--[if IE 8]>
  <html class="no-js lt-ie9" lang="en">
  <![endif]-->
<!--[if gt IE 8]>
    <!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="JPush Offical"> 
    <title>Android SDK 概述 - 极光文档</title> 
    <link rel="shortcut icon" href="../../favicon.ico">
    <script src="../../js/jquery-2.1.4.js"></script>

    <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
    <script src="../../js/bootstrap/js/bootstrap.js"></script>

    <link href="../../js/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
    
    <script>
    // Current page data
    var mkdocs_page_name = "Android SDK 概述";
    var mkdocs_page_input_path = "client/im_sdk_android.md";
    var mkdocs_page_url = "/client/im_sdk_android/";
    </script>
    
    <script src="../../js/jpush.js"></script> 
</head>

<body data-spy="scroll" data-target="#navbar-right">
    <div class="container-fluid">
        <div class="container">
            <div class="row">
                <div class="col-lg-3  col-md-3  col-sm-3 ">
                    <div id="doc-icon">
                        <a href="/"><img src="/img/icon/logo.png"></a>
                    </div>
                </div>
                <div class="col-lg-7 col-md-8  col-sm-8">
                    <div class="header">
                        <ul class="nav nav-tabs">
                            <li role="presentation" >
                                <a href="/jpush/guideline/intro/" id="jpush-top">JPush</a></li>
                            <li role="presentation" >
                                <a href="/jmessage/guideline/jmessage_guide/" id="jmessage-top">JMessage</a></li>
                            <li role="presentation" >
                                <a href="/jsms/guideline/JSMS_guide/" id="jsms-top">短信验证码</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2  col-md-1 col-sm-1">
                    <div>
                        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-3  col-md-3 col-sm-4">
                <div id="navbar-left">
                    <ul class="wy-menu">
                        
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    入门指南 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../../guideline/jmessage_guide/">JMessage 产品简介</a>
    </li>
                                
                                
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    Android 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                
                                    <li class="toctree-l1 current">
        <a class="current" href="./">Android SDK 概述</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../jmessage_android_guide/">JMessage Android SDK 集成指南</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../im_errorcode_android/">IM SDK ErrorCode 定义</a>
    </li>
                                
                                
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    iOS 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../im_sdk_ios/">iOS SDK 概述</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../jmessage_ios_guide/">JMessage iOS SDK 集成指南</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../im_errorcode_ios/">IM SDK ErrorCode 定义</a>
    </li>
                                
                                
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    JS 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../im_sdk_js/">JMessage WEB SDK 开发文档</a>
    </li>
                                
                                
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    REST API 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../../server/rest_api_im/">IM REST API</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../../server/rest_api_im_report/">IM REST Report</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../im_errorcode_server/">Server ErrorCode 定义</a>
    </li>
                                
                                
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    高级 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../../advanced/im_message_protocol/">IM 消息协议</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../../advanced/im_objects/">IM 业务对象</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../../advanced/jmessage_callback/">实时消息回调</a>
    </li>
                                
                                    <li class="toctree-l1 ">
        <a class="" href="../../advanced/jmessage_topics/">极光IM高级话题</a>
    </li>
                                
                                
                                </ul>
                                <li>
                        <li class="subnav">
                            
                                <ul class="subnavul">
                                    <li class="subnavli_single " >
                                        <span>
                          <a href="../../updates/" class="">最近更新</a></span>
                                    </li>
                                </ul>
                                <li>
                        <li class="subnav">
                            
                                <ul class="subnavul">
                                    <li class="subnavli_single " >
                                        <span>
                          <a href="../../resources/" class="">资源下载</a></span>
                                    </li>
                                </ul>
                                <li></ul>
                    </ul>
                </div>
            </div>
            <div class="col-lg-8  col-md-9  col-sm-8">
                <div id="content-top"></div>
                <section >
                    <div class="rst-content"><div id="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../guideline/jmessage_guide/">极光文档</a>></li>
    
      
        
          <li><a href="./">Android</a> ></li>
        
      
    
    <li>
    Android SDK 概述
    <!--
    <a href="./">Android SDK 概述</a>
    -->
    </li>
  </ul>
</div>
                        <div role="main">
                            <div class="section"> <h1>极光IM SDK - Android</h1>

<ul>
<li><a href="../../resources/">极光IM 客户端 DEMO 下载</a></li>
<li><a href="../im_android_api_docs/">极光IM Android API Java docs</a></li>
<li><a href="../im_errorcode_android/#jmessage-android">极光IM Android 错误码</a></li>
</ul>
<h3 id="_1">概述</h3>
<p>极光IM（英文名JMessage） SDK 基于 JPush 推送 SDK 开发，提供了 Push SDK 的完整功能，并提供 IM 即时通讯功能。</p>
<p>App 集成了 IM SDK 就不应再集成 JPush SDK（只提供 Push 功能的 SDK）。</p>
<p>要了解极光IM的概述信息，请参考文档：<a href="../../guideline/jmessage_guide">极光IM指南</a></p>
<h4 id="_2">消息</h4>
<p>极光IM 最核心的功能是 IM 即时消息的功能。</p>
<ul>
<li>保证消息及时下发；</li>
<li>单聊，群聊；</li>
<li>消息类型：文本、语音、图片；</li>
<li>用户未在线时保存离线消息；</li>
<li>基于 JPush 原有的大容量稳定的长连接、大容量消息并发能力；</li>
</ul>
<h4 id="_3">用户</h4>
<p>开发者的用户，基于 username / password 注册到 JMessage。</p>
<p>SDK 侧可以发起注册用户，也可由服务器端批量发起注册。</p>
<p>用户登录 App，也同时登录到 JMessage。登录后，就可以向其他 username 发聊天消息，也可以收到来自其他 username 的消息，或者群组消息了。</p>
<p>用户 A 是否有权限向用户 B 发消息，由 App 逻辑自己控制。</p>
<p>可选让用户把头像等用户属性更新到 JMessage。</p>
<h4 id="_4">群组</h4>
<p>可以把多个 username 加入到一个群组里，向群组发群聊消息。</p>
<ul>
<li>创建群组、退出群组；</li>
<li>加群组成员、移除群组成员；</li>
</ul>
<h4 id="_5">好友</h4>
<ul>
<li>jmessage android sdk 从1.4.0版本开始提供接口实现对用户好友关系的托管，以及相关好友请求的发送和接收。
除此之外的任何建立在好友关系之上的功能（如仅限于好友之间才能进行的聊天等），需要开发者的应用层自己实现。</li>
</ul>
<h3 id="api">API 列表</h3>
<p>以下列出主要的 JMessage SDK 提供的 API。完整的 API 与 类信息，请访问：<a href="../im_android_api_docs/">API Java docs</a></p>
<h4 id="sdk">SDK初始化</h4>
<p>在调用IM其他接口前必须先调此接口初始化SDK，推荐在application类中调用。</p>
<pre><code>public static synchronized void init(Context context)
</code></pre>

<p>参数说明</p>
<ul>
<li>Context context 应用程序上下文对象。</li>
</ul>
<h4 id="_6">注册与登录</h4>
<h5 id="_7">注册</h5>
<pre><code>  public static void register(String username, String password, BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>String username 用户名</li>
<li>String password 用户密码</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<h5 id="_8">登录</h5>
<pre><code>  public static void login(String username, String password, BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>String username 用户名</li>
<li>String password 用户密码</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<h5 id="_9">退出登录</h5>
<pre><code>  public static void logout();
</code></pre>

<p>参数说明</p>
<ul>
<li>无</li>
</ul>
<h4 id="_10">用户属性维护</h4>
<h5 id="_11">获取用户信息</h5>
<pre><code>  public static void getUserInfo(String username, GetUserInfoCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>String username 用户名</li>
<li>GetUserInfoCallback callback 结果回调</li>
</ul>
<p>回调</p>
<pre><code>  public abstract void gotResult(int responseCode, String responseMessage, UserInfo userInfo);
</code></pre>

<ul>
<li>UserInfo userInfo 用户信息</li>
</ul>
<h5 id="_12">获取用户信息(跨应用)</h5>
<p>获取用户信息，此接口可用来获取不同appKey下用户的信息,如果appKey为空，则默认获取当前appKey下的用户信息。</p>
<pre><code>  public static void getUserInfo(String username, String appKey, GetUserInfoCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>String username 用户名</li>
<li>String appKey 指定的appKey</li>
<li>GetUserInfoCallback callback 结果回调</li>
</ul>
<h5 id="_13">从本地获取当前登录账号的用户信息</h5>
<pre><code>  public static UserInfo getMyInfo();
</code></pre>

<p>参数说明</p>
<ul>
<li>无</li>
</ul>
<p>返回</p>
<ul>
<li>UserInfo  当前登录用户的用户信息。</li>
</ul>
<h5 id="_14">更新用户信息</h5>
<pre><code>  public static void updateMyInfo(UserInfo.Field updateField, UserInfo info, BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>UserInfo.Field updateField 枚举类型，表示需要更新的用户信息字段。包括：</li>
<li>nickname</li>
<li>birthday</li>
<li>signature</li>
<li>gender</li>
<li>region</li>
<li>UserInfo userInfo 待更新的用户信息（对象）。SDK将根据field参数来判断需要将哪个属性更新到服务器上去。</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<h5 id="_15">更新用户密码</h5>
<pre><code>  public static void updateUserPassword(String oldPassword, String newPassword, BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>String oldPassword 更新前密码</li>
<li>String newPassword 更新后密码</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<h5 id="_16">更新用户头像</h5>
<pre><code>  public static void updateUserAvatar(File avatar, BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>File avatar 用户头像文件</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<h4 id="_17">创建消息</h4>
<h5 id="_18">创建文字消息</h5>
<pre><code>    /**
     * 创建一条单聊文本消息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param username 聊天对象用户名
     * @param appKey   聊天对象所属应用的appKey
     * @param text     文本内容
     * @return 消息对象
     */
    public static Message createSingleTextMessage(String username, String appKey, String text)

    /**
     * 创建一条群聊文本信息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param groupID 群组的groupID
     * @param text    文本内容
     * @return 消息对象
     */
    public static Message createGroupTextMessage(long groupID, String text)
</code></pre>

<h5 id="_19">创建图片消息</h5>
<pre><code>    /**
     * 创建一条单聊图片信息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param username  聊天对象的用户名
     * @param appKey    聊天对象所属应用的appKey
     * @param imageFile 图片文件
     * @return 消息对象
     * @throws FileNotFoundException
     */
    public static Message createSingleImageMessage(String username, String appKey, File imageFile) throws FileNotFoundException

    /**
     * 创建一条群聊图片信息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param groupID   群组的groupID
     * @param imageFile 图片文件
     * @return 消息对象
     * @throws FileNotFoundException
     */
    public static Message createGroupImageMessage(long groupID, File imageFile) throws FileNotFoundException
</code></pre>

<h5 id="_20">创建语音消息</h5>
<pre><code>    /**
     * 创建一条单聊语音信息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param username  聊天对象的用户名
     * @param appKey    聊天对象所属应用的appKey
     * @param voiceFile 语音文件
     * @param duration  语音文件时长
     * @return 消息对象
     * @throws FileNotFoundException
     */
    public static Message createSingleVoiceMessage(String username, String appKey, File voiceFile, int duration) throws FileNotFoundException

    /**
     * 创建一条群聊语音信息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param groupID   群组groupID
     * @param voiceFile 语音文件
     * @param duration  语音文件时长
     * @return 消息对象
     * @throws FileNotFoundException
     */
    public static Message createGroupVoiceMessage(long groupID, File voiceFile, int duration) throws FileNotFoundException
</code></pre>

<h5 id="_21">创建位置消息</h5>
<pre><code>    /**
     * 创建一条单聊地理位置消息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param username  聊天对象的用户名
     * @param appKey    聊天对象所属应用的appKey
     * @param latitude  纬度信息
     * @param longitude 经度信息
     * @param scale     地图缩放比例
     * @param address   详细地址信息
     * @return 消息对象
     */
    public static Message createSingleLocationMessage(String username, String appKey, double latitude, double longitude, int scale, String address)

    /**
     * 创建一条群聊地理位置消息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param groupId   群组groupID
     * @param latitude  纬度信息
     * @param longitude 经度信息
     * @param scale     地图缩放比例
     * @param address   详细地址信息
     * @return 消息对象
     */
    public static Message createGroupLocationMessage(long groupId, double latitude, double longitude, int scale, String address)
</code></pre>

<h5 id="_22">创建文件消息</h5>
<pre><code>    /**
     * 创建一条单聊file消息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param userName 聊天对象的用户名
     * @param appKey   聊天对象所属应用的appKey
     * @param file     发送的文件
     * @param fileName 指定发送的文件名称,如果不填或为空，则默认使用文件原名。
     * @return 消息对象
     * @throws FileNotFoundException
     */
    public static Message createSingleFileMessage(String userName, String appKey, File file, String fileName) throws FileNotFoundException, JMFileSizeExceedException

    /**
     * 创建一条群聊file消息，此方法是创建message的快捷接口，对于不需要关注会话实例的开发者可以使用此方法
     * 快捷的创建一条消息。其他的情况下推荐使用{@link Conversation#createSendMessage(MessageContent)}
     * 接口来创建消息
     *
     * @param groupID  群组groupID
     * @param file     发送的文件
     * @param fileName 指定发送的文件名称,如果不填或为空，则默认使用文件原名。
     * @return 消息对象
     * @throws FileNotFoundException
     */
    public static Message createGroupFileMessage(long groupID, File file, String fileName) throws FileNotFoundException, JMFileSizeExceedException
</code></pre>

<h5 id="_23">创建自定义消息</h5>
<pre><code> /**
  * 创建一条单聊自定义消息
  *
  * @param username  聊天对象username
  * @param valuesMap 包含自定义键值对的map.
  * @return 消息对象
  */
public static Message createSingleCustomMessage(String username,
   Map&lt;? extends String, ?&gt; valuesMap)

 /**
  * 创建一条群聊自定义消息
  *
  * @param groupID   群组groupID
  * @param valuesMap 包含了自定义键值对的map
  * @return  消息对象
  */
public static Message createGroupCustomMessage(long groupID,
  Map&lt;? extends String, ?&gt; valuesMap)
</code></pre>

<h4 id="_24">发送消息</h4>
<p>向服务器给发送对象发送消息，并且保存到本地会话。</p>
<pre><code>  public static void sendMessage(Message message);
</code></pre>

<p>参数说明</p>
<ul>
<li>Message message 消息（对象）</li>
</ul>
<h4 id="_25">本地会话管理</h4>
<h5 id="_26">获取会话列表</h5>
<p>从本地数据库取得。同步返回。</p>
<pre><code>  public List&lt;Conversation&gt; getConversationList();
</code></pre>

<p>参数说明</p>
<ul>
<li>无</li>
</ul>
<p>返回</p>
<ul>
<li><code>List&lt;Conversation&gt;</code> 会话列表。</li>
</ul>
<h5 id="_27">获取单个单聊会话</h5>
<p>获取单聊会话信息，默认获取本appKey下username的单聊会话。</p>
<pre><code>  public static Conversation getSingleConversation(String username);
</code></pre>

<p>参数说明</p>
<ul>
<li>String username 目标的用户用户名。</li>
</ul>
<p>返回</p>
<ul>
<li>根据参数匹配得到的单聊会话对象。</li>
</ul>
<h5 id="_28">获取单个群聊会话</h5>
<pre><code>  public static Conversation getGroupConversation(long groupID);
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupID 目标的群的群ID。</li>
</ul>
<p>返回</p>
<ul>
<li>根据参数匹配得到的群聊会话对象。</li>
</ul>
<h5 id="_29">删除单个单聊会话</h5>
<p>删除单聊的会话，同时删除掉本地聊天记录。默认删除本appKey下username的会话</p>
<pre><code>  public static boolean deleteSingleConversation(String username);
</code></pre>

<p>参数说明</p>
<ul>
<li>String username 目标的用户用户名。</li>
</ul>
<p>返回</p>
<ul>
<li>是否删除成功。</li>
</ul>
<h5 id="_30">删除单个单聊会话（跨应用）</h5>
<p>删除与指定appKey下username的单聊的会话，同时删除掉本地聊天记录。,如果appKey为空则默认尝试删除本应用appKey下对应username的会话。</p>
<pre><code>  public static boolean deleteSingleConversation(String username,String appKey);
</code></pre>

<p>参数说明</p>
<ul>
<li>String username 目标的用户用户名。</li>
<li>String appKey 目标用户所属的appKey</li>
</ul>
<p>返回</p>
<ul>
<li>是否删除成功。</li>
</ul>
<h5 id="_31">删除单个群聊会话</h5>
<pre><code>  public static boolean deleteGroupConversation(long groupID);
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupID 目标群的群ID。</li>
</ul>
<p>返回</p>
<ul>
<li>是否删除成功。</li>
</ul>
<h4 id="_32"><span id="Event">事件处理</span></h4>
<h5 id="1">1、事件接收类的注册</h5>
<pre><code>  public static void registerEventReceiver(Object receiver);
  public static void registerEventReceiver(Object receiver, int priority);
</code></pre>

<p>参数说明</p>
<ul>
<li>Object receiver 消息接收类对象</li>
<li>int priority 定义事件接收者接收事件的优先级，默认值为0，优先级越高将越先接收到事件。（优先级只对同一个线程模式中的接收者有效）</li>
</ul>
<h5 id="2">2、事件接收类的解绑</h5>
<pre><code>  public static void unRegisterEventReceiver(Object receiver);
</code></pre>

<p>参数说明</p>
<ul>
<li>Object receiver 消息接收类对象，对象解绑之后将不再接收到任何event。</li>
</ul>
<h5 id="3">3、事件接收</h5>
<p>注册事件接收类之后，需要在消息接收类中实现如下方法来接收对应消息。sdk将根据实现方法的方法名来区分不同的线程模式，常用的线程模式有onEvent(默认线程模式)和onEventMainThread(主线程模式)两种。</p>
<p>可以通过定义不同类型的参数，来接收不同种类的事件。具体事件类型定义见 “事件类型” 一节</p>
<h6 id="_33">默认线程（子线程）模式</h6>
<pre><code>public void onEvent(EventEntity event){
  //do your own business
}
</code></pre>

<p>方法体将在默认线程（子线程）中被调用， 可以用来处理耗时操作。</p>
<p>参数定义</p>
<ul>
<li>EventEntity event 事件对象。（ 定义不同类型参数可以接收不同种类事件，具体用法可以参考“示例代码“。）</li>
</ul>
<h6 id="_34">主线程模式</h6>
<pre><code>public void onEventMainThread(EventEntity event){
  //do your own business
}
</code></pre>

<p>方法体将在主线程中被调用，可以用来刷新UI。
参数定义</p>
<ul>
<li>EventEntity event 事件对象。</li>
</ul>
<h5 id="4">4、事件类型</h5>
<p>消息事件实体类 MessageEvent</p>
<div class="table-d" align="left" >
  <table border="1" width = "100%">
    <tr  bgcolor="#D3D3D3" >
      <th width="20px">方法</th>
      <th width="40px">类型</th>
      <th width="300px">说明</th>
    </tr>
    <tr >
      <td >getMessage()</td>
      <td >Message</td>
      <td >获取消息对象</td>
    </tr>
  </table>
</div>

<p></br></p>
<p>会话刷新事件实体类 ConversationRefreshEvent</p>
<div class="table-d" align="left" >
  <table border="1" width = "100%">
    <tr  bgcolor="#D3D3D3" >
      <th width="10px">方法</th>
      <th width="20px">类型</th>
      <th width="370px">说明</th>
    </tr>
    <tr >
      <td >getConversation()</td>
      <td >Conversation</td>
      <td >获取需要被刷新的会话对象</td>
    </tr>
  </table>
</div>

<p></br></p>
<p>通知栏点击事件实体类NotificationClickEvent</p>
<div class="table-d" align="left" >
  <table border="1" width = "100%">
    <tr  bgcolor="#D3D3D3" >
      <th width="30px">方法</th>
      <th width="20px">类型</th>
      <th width="300px">说明</th>
    </tr>
    <tr >
      <td >getMessage()</td>
      <td >Message</td>
      <td >获取点击的通知所对应的消息对象</td>
    </tr>
  </table>
</div>

<p></br></p>
<p>用户下线事件UserLogoutEvent <strong>(已过时，请使用LoginStateChangeEvent代替)</strong></p>
<div class="table-d" align="left" >
  <table border="1" width = "100%">
    <tr  bgcolor="#D3D3D3" >
      <th width="100px">方法</th>
      <th width="20px">类型</th>
      <th width="300px">说明</th>
    </tr>
    <tr >
      <td >getMyInfo()</td>
      <td >UserInfo</td>
      <td >获取当前被登出账号的信息</td>
    </tr>
  </table>
</div>

<p></br></p>
<p>用户被删除事件UserDeletedEvent <strong>(已过时，请使用LoginStateChangeEvent代替)</strong></p>
<div class="table-d" align="left" >
  <table border="1" width = "100%">
    <tr  bgcolor="#D3D3D3" >
      <th width="100px">方法</th>
      <th width="20px">类型</th>
      <th width="300px">说明</th>
    </tr>
    <tr >
      <td >getMyInfo()</td>
      <td >UserInfo</td>
      <td >获取当前被删除账号的信息</td>
    </tr>
  </table>
</div>

<p></br></p>
<p>用户登录状态变更事件LoginStateChangeEvent
<div class="table-d" align="left" >
  <table border="1" width = "100%">
    <tr  bgcolor="#D3D3D3" >
      <th width="100px">方法</th>
      <th width="20px">类型</th>
      <th width="300px">说明</th>
    </tr>
    <tr >
      <td >getMyInfo()</td>
      <td >UserInfo</td>
      <td >获取当前登录状态改变的账号的信息</td>
    </tr>
    <tr >
      <td >getReason()</td>
      <td >Reason</td>
      <td >获取登录状态变更原因。</td>
    </tr>
  </table>
</div></p>
<h5 id="5">5、示例代码</h5>
<p>接收消息事件</p>
<pre><code class="Java">class MessageEventReceiver extends Activity{

  @Override
  protected void onCreate() {
    super.onCreate(savedInstanceState);
    JMessageClient.registerEventReceiver(this);
  }

  @Override
  protected void onDestroy() {
    JMessageClient.unRegisterEventReceiver(this);
    super.onDestroy();
  }

  public void onEvent(MessageEvent event){
    Message msg = event.getMessage();

    switch (msg.getContentType()){
        case text:
            //处理文字消息
            TextContent textContent = (TextContent) msg.getContent();
            textContent.getText();
            break;
        case image:
            //处理图片消息
            ImageContent imageContent = (ImageContent) msg.getContent();
            imageContent.getLocalPath();//图片本地地址
            imageContent.getLocalThumbnailPath();//图片对应缩略图的本地地址
            break;
        case voice:
            //处理语音消息
            VoiceContent voiceContent = (VoiceContent) msg.getContent();
            voiceContent.getLocalPath();//语音文件本地地址
            voiceContent.getDuration();//语音文件时长
            break;
        case custom:
            //处理自定义消息
            CustomContent customContent = (CustomContent) msg.getContent();
            customContent.getNumberValue(&quot;custom_num&quot;); //获取自定义的值
            customContent.getBooleanValue(&quot;custom_boolean&quot;);
            customContent.getStringValue(&quot;custom_string&quot;);
            break;
        case eventNotification:
        //处理事件提醒消息
        EventNotificationContent eventNotificationContent = (EventNotificationContent)msg.getContent();
        switch (eventNotificationContent.getEventNotificationType()){
            case group_member_added:
            //群成员加群事件
            break;
            case group_member_removed:
            //群成员被踢事件
            break;
            case group_member_exit:
            //群成员退群事件
            break;
        }
        break;
    }
  }
 }
</code></pre>

<p>接收通知栏点击事件</p>
<pre><code class="Java">class NotificationClickEvent extends Activity{
    @Override
    protected void onCreate() {
        super.onCreate(savedInstanceState);
        JMessageClient.registerEventReceiver(this);
    }
    @Override
    protected void onDestroy() {
        JMessageClient.unRegisterEventReceiver(this);
        super.onDestroy();
    }
    public void onEvent(NotificationClickEvent event){
        Intent notificationIntent = new Intent(mContext, ChatActivity.class);
        mContext.startActivity(notificationIntent);//自定义跳转到指定页面
    }

}
</code></pre>

<p>用户登录状态变更事件</p>
<pre><code>class UserLogoutEventReceiver extends Activity{
    @Override
    protected void onCreate() {
        super.onCreate(savedInstanceState);
        JMessageClient.registerEventReceiver(this);
    }
    @Override
    protected void onDestroy() {
        JMessageClient.unRegisterEventReceiver(this);
        super.onDestroy();
    }
    public void onEvent(LoginStateChangeEvent event){
        LoginStateChangeEvent.Reason reason = event.getReason();//获取变更的原因
        UserInfo myInfo = event.getMyInfo();//获取当前被登出账号的信息
        switch (reason) {
            case user_password_change:
                //用户密码在服务器端被修改
                break;
            case user_logout:
                //用户换设备登录
                break;
            case user_deleted:
                //用户被删除
                break;
        }
     }

}
</code></pre>

<h4 id="_35">群组信息维护</h4>
<h5 id="_36">创建群组</h5>
<pre><code>  public static void createGroup(String groupName, String groupDesc, CreateGroupCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>String groupName 群名称</li>
<li>String groupDesc 群描述</li>
<li>CreateGroupCallback callback 结果回调</li>
</ul>
<p>回调</p>
<pre><code>  public abstract void gotResult(int responseCode, String responseMsg, long groupId);
</code></pre>

<ul>
<li>long groupId 新创建成功的群组ID（resopnseCode = 0 时）。</li>
</ul>
<h5 id="_37">获取群组列表</h5>
<pre><code>public static void getGroupIDList(GetGroupListCallback callback)
</code></pre>

<p>回调</p>
<pre><code>public abstract void gotResult(int responseCode, String responseMessage,
            List&lt;Long&gt; groupIDList)
</code></pre>

<ul>
<li><code>List&lt;Long&gt;</code> groupIDList  当前用户所加入的群组的groupID的list</li>
</ul>
<h5 id="_38">获取群组详情</h5>
<pre><code>  public static void getGroupInfo(long groupId, GetGroupInfoCallback callback)
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupId 群ID</li>
<li>GetGroupInfoCallback callback 结果回调</li>
</ul>
<p>回调</p>
<pre><code>  public void gotResult(int responseCode, String responseMessage, Group group)
</code></pre>

<ul>
<li>Group group 返回的群组详情</li>
</ul>
<h5 id="_39">更新群组名称</h5>
<pre><code>  public static void updateGroupName(long groupID,
      String groupName,BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupID 待更新信息的群组ID</li>
<li>String groupName 新的名称</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<h5 id="_40">更新群组详情</h5>
<pre><code>  public static void updateGroupDescription(long groupID,
      String groupDesc,BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupID 待更新信息的群组ID</li>
<li>String groupName 新的群组详情描述</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<h5 id="_41">加群组成员</h5>
<pre><code>  public static void addGroupMembers(long groupId, List&lt;String&gt; usernameList, BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupId 待加群的群组ID。创建群组时返回的。</li>
<li>List usernameList 群组成员列表，使用成员 username。</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<h5 id="_42">移除群组成员</h5>
<pre><code>  public static void removeGroupMembers(long groupId, List&lt;String&gt; usernameList, BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupId 待删除成员的群ID。</li>
<li>List usernameList 待删除的成员列表。</li>
<li>BasicCallback callback 结果回调。</li>
</ul>
<h5 id="_43">退出群组</h5>
<pre><code>  public static void exitGroup(long groupId, BasicCallback callback);
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupId 待退出的群ID。</li>
<li>BasicCallback callback 结果回调。</li>
</ul>
<h5 id="_44">获取群组成员列表</h5>
<pre><code>  public static void getGroupMembers(long groupID,
      GetGroupMembersCallback callback)
</code></pre>

<p>参数说明</p>
<ul>
<li>long groupId 群组ID</li>
<li>GetGroupMembersCallback callback</li>
</ul>
<p>回调</p>
<pre><code>  public void gotResult(int responseCode, String responseMessage, List&lt;String&gt; members);
</code></pre>

<ul>
<li>List members 成员列表(username)。</li>
</ul>
<h4 id="_45">黑名单管理</h4>
<h5 id="_46">将用户加入黑名单</h5>
<pre><code>public static void addUsersToBlacklist(List&lt;String&gt; usernames, BasicCallback callback)
</code></pre>

<p>参数说明</p>
<ul>
<li>List<String> usernames 被加入黑名单的用户username列表</li>
<li>BasicCallback callback 回调接口</li>
</ul>
<h5 id="_47">将用户移出黑名单</h5>
<pre><code>public static void delUsersFromBlacklist(List&lt;String&gt; usernames, BasicCallback callback)
</code></pre>

<p>参数说明</p>
<ul>
<li>List<String> usernames 被移出黑名单的用户username列表</li>
<li>BasicCallback callback 回调接口</li>
</ul>
<h5 id="_48">获取被当前用户加入黑名单的用户列表</h5>
<pre><code>public static void getBlacklist(GetBlacklistCallback callback)
</code></pre>

<p>参数说明</p>
<ul>
<li>GetBlacklistCallback 获取黑名单回调接口</li>
</ul>
<p>回调</p>
<pre><code>  public abstract void gotResult(int responseCode,
    String responseMessage, List&lt;UserInfo&gt; userInfos);
</code></pre>

<ul>
<li><code>List&lt;UserInfo&gt;</code> userInfos  被拉入黑名单的用户的UserInfo</li>
</ul>
<h4 id="_49">通知栏管理</h4>
<h5 id="_50">设置通知展示类型</h5>
<pre><code>public static void setNotificationMode(int mode);
</code></pre>

<p>参数说明</p>
<ul>
<li>
<p>int mode  显示通知的模式</p>
<ul>
<li>JMessageClient.NOTI_MODE_DEFAULT 显示通知，有声音，有震动。</li>
<li>JMessageClient.NOTI_MODE_NO_SOUND 显示通知，无声音，有震动。</li>
<li>JMessageClient.NOTI_MODE_NO_VIBRATE 显示通知，有声音，无震动。</li>
<li>JMessageClient.NOTI_MODE_SILENCE 显示通知，无声音，无震动。</li>
<li>JMessageClient.NOTI_MODE_NO_NOTIFICATION 不显示通知。</li>
</ul>
</li>
</ul>
<h5 id="_51">进入单聊会话</h5>
<p>进入单聊会话。默认进入的是本应用appKey下用户的会话。
    UI在进入单聊会话页面时需要调用此函数，SDK会根据传入的username来决定是否需要发送通知</p>
<pre><code>public static void enterSingleConversaion(String username)
</code></pre>

<p>参数定义</p>
<ul>
<li>String username 单聊聊天对象的username</li>
</ul>
<h5 id="_52">进入单聊会话(跨应用)</h5>
<p>在进入聊天会话界面时调用，设置当前正在聊天的对象，sdk用来判断notification是否需要展示。若appKey为空则默认填充本应用的appKey。
    UI在进入单聊会话页面时需要调用此函数，SDK会根据传入的username来决定是否需要发送通知</p>
<pre><code>public static void enterSingleConversaion(String username,String appKey)
</code></pre>

<p>参数定义</p>
<ul>
<li>String username 单聊聊天对象的username</li>
<li>String appKey 聊天对象所属appKey</li>
</ul>
<h5 id="_53">进入群聊会话</h5>
<p>进入群聊会话。UI在进入群聊会话页面时需要调用此函数，SDK会根据传入的groupID来决定是否需要发送通知</p>
<pre><code>public static void enterGroupConversation(long groupID)
</code></pre>

<p>参数定义</p>
<ul>
<li>long groupID 群聊聊天对象的群ID</li>
</ul>
<h5 id="_54">退出会话</h5>
<p>退出会话。UI在退出会话页面时需要调用此函数。</p>
<pre><code>public static void exitConversaion();
</code></pre>

<h5 id="_55">通知栏点击事件监听</h5>
<p>用户可以通过接受通知栏点击事件NotificationClickEvent，来实现自定义跳转，该事件如果没有接收者，点击通知栏时SDK将默认跳转到程序主界面。</p>
<p>事件接收方法见<a href="#Event">事件处理</a>一节</p>
<h4 id="_56">好友列表管理</h4>
<p>jmessage sdk 好友模块仅实现对用户好友关系的托管，以及相关好友请求的发送和接收。除此之外的任何建立在好友关系之上的功能（如仅限于好友之间才能进行的聊天等），需要开发者的应用层自己实现。</p>
<h5 id="_57">发送好友添加请求</h5>
<p>发送添加好友请求。在对方未做回应的前提下，允许重复发送添加好友的请求。请求发送后对方会收到一条好友请求的事件。</p>
<pre><code>public static void sendInvitationRequest(final String targetUsername,String appKey, final String reason, final BasicCallback callback)
</code></pre>

<p>参数定义</p>
<ul>
<li>String targetUsername 被邀请方用户名</li>
<li>String appKey 被邀请方用户的appKey,如果为空则默认从本应用appKey下查找用户。</li>
<li>String reason 申请理由</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<p>代码示例：</p>
<pre><code>ContactManager.sendInvitationRequest(&quot;test_user&quot;, &quot;test_appkey&quot;, &quot;hello&quot;, new BasicCallback() {
            @Override
            public void gotResult(int responseCode, String responseMessage) {
                if (0 == responseCode) {
                    //好友请求请求发送成功
                } else {
                    //好友请求发送失败
                }
            }
        });
</code></pre>

<h5 id="_58">接受好友请求</h5>
<p>接受对方的好友请求，操作成功后，对方会出现在自己的好友列表中，双方建立起好友关系。请求发送后对方会收到一条好友请求被接受的事件。</p>
<pre><code>public static void acceptInvitation(final String targetUsername, String appKey, final BasicCallback callback)
</code></pre>

<p>参数定义</p>
<ul>
<li>String targetUsername 邀请方的用户名</li>
<li>String appKey 邀请方用户的appKey,如果为空则默认从本应用appKey下查找用户。</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<p>代码示例：</p>
<pre><code>ContactManager.acceptInvitation(&quot;test_user&quot;, &quot;test_appkey&quot;, new BasicCallback() {
            @Override
            public void gotResult(int responseCode, String responseMessage) {
                if (0 == responseCode) {
                    //接收好友请求成功
                } else {
                    //接收好友请求失败
                }
            }
        });
</code></pre>

<h5 id="_59">拒绝好友请求</h5>
<p>拒绝对方的好友请求。请求发送后对方会收到一条好友请求被拒绝的事件。</p>
<pre><code>public static void declineInvitation(final String targetUsername, String appKey, String reason, final BasicCallback callback)
</code></pre>

<p>参数定义</p>
<ul>
<li>String targetUsername 邀请方用户名</li>
<li>String appKey 邀请方用户的appKey,如果为空则默认从本应用appKey下查找用户。</li>
<li>String reason 拒绝理由</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<p>代码示例：</p>
<pre><code>ContactManager.declineInvitation(&quot;test_user&quot;, &quot;test_appkey&quot;, &quot;sorry~&quot;, new BasicCallback() {
            @Override
            public void gotResult(int responseCode, String responseMessage) {
                if (0 == responseCode) {
                    //拒绝好友请求成功
                } else {
                    //拒绝好友请求失败
                }
            }
        });
</code></pre>

<h5 id="_60">获取好友列表</h5>
<p>获取当前登陆用户的好友列表，异步返回结果。</p>
<pre><code>public static void getFriendList(final GetUserInfoListCallback callback)
</code></pre>

<p>参数定义</p>
<ul>
<li>GetUserInfoListCallback callback 结果回调。</li>
</ul>
<p>代码示例：</p>
<pre><code>ContactManager.getFriendList(new GetUserInfoListCallback() {
            @Override
            public void gotResult(int responseCode, String responseMessage, List&lt;UserInfo&gt; userInfoList) {
                if (0 == responseCode) {
                    //获取好友列表成功
                } else {
                    //获取好友列表失败
                }
            }
        });
</code></pre>

<h5 id="_61">删除好友</h5>
<p>将用户从你的好友列表中移除，移除成功后，对方会收到一条好友被移除的事件。</p>
<pre><code>public void removeFromFriendList(BasicCallback callback)
</code></pre>

<p>参数定义</p>
<ul>
<li>BasicCallback callback 结果回调</li>
</ul>
<p>代码示例：</p>
<pre><code>userinfo.removeFromFriendList(new BasicCallback() {
            @Override
            public void gotResult(int responseCode, String responseMessage) {
                if (0 == responseCode) {
                    //移出好友列表成功
                } else {
                    //移出好友列表失败
                }
            }
        });
</code></pre>

<h5 id="_62">更新用户备注名/备注信息</h5>
<p>仅当用户存在于你的好友列表中时，才能更新其用户备注名和备注信息。</p>
<pre><code>public abstract void updateNoteName(String noteName, BasicCallback callback)

public abstract void updateNoteText(String noteText, BasicCallback callback)
</code></pre>

<p>参数定义：</p>
<ul>
<li>String noteName 新的备注名</li>
<li>String noteText 新的备注信息</li>
<li>BasicCallback callback 结果回调</li>
</ul>
<p>代码示例：</p>
<pre><code>userinfo.updateNoteName(&quot;new_note_name&quot;, new BasicCallback() {
            @Override
            public void gotResult(int responseCode, String responseMessage) {
                if (0 == responseCode) {
                    //更新备注名成功
                } else {
                    //更新备注名失败
                }
            }
        });
</code></pre>

<h5 id="_63">联系人相关通知事件</h5>
<p>新增联系人相关通知事件<code>ContactNotifyEvent</code>,具体事件处理方法见：<a href="#Event">事件处理</a>一节
<div class="table-d" align="left" >
  <table border="1" width = "100%">
    <tr  bgcolor="#D3D3D3" >
      <th width="100px">方法</th>
      <th width="20px">类型</th>
      <th width="300px">说明</th>
    </tr>
    <tr >
      <td >getType()</td>
      <td >ContactNotifyEvent.Type</td>
      <td >获取联系人通知事件的具体类型，具体类型见<a href="../im_android_api_docs/cn/jpush/im/android/api/event/ContactNotifyEvent.html">Type</a>定义</td>
    </tr>
    <tr >
      <td >getReason()</td>
      <td >String</td>
      <td >获取事件发生的理由，该字段由对方发起请求时所填，对方如果未填则将返回默认字符串</td>
    </tr>
    <tr >
      <td >getFromUsername()</td>
      <td >String</td>
      <td >获取事件发送者的username</td>
    </tr>
    <tr >
      <td >getFromUserAppKey()</td>
      <td >String</td>
      <td >获取事件发送者用户所属应用的appKey</td>
    </tr>
  </table>
</div></p>
<p>示例代码：</p>
<pre><code>class ContactNotifyEventReceiver extends Activity{

  @Override
  protected void onCreate() {
    super.onCreate(savedInstanceState);
    JMessageClient.registerEventReceiver(this);
  }

  @Override
  protected void onDestroy() {
    JMessageClient.unRegisterEventReceiver(this);
    super.onDestroy();
  }

  public void onEvent(ContactNotifyEvent event) {
        String reason = event.getReason();
        String fromUsername = event.getFromUsername();
        String appkey = event.getfromUserAppKey();

        switch (event.getType()) {
            case invite_received://收到好友邀请
                //...
                break;
            case invite_accepted://对方接收了你的好友邀请
                //...
                break;
            case invite_declined://对方拒绝了你的好友邀请
                //...
                break;
            case contact_deleted://对方将你从好友中删除
                //...
                break;
            default:
                break;
        }
    }

}

</code></pre>

<h3 id="_64">免打扰</h3>
<p>可以将用户/群组添加到“免打扰”列表中，收到免打扰用户/群组发过来的消息时，sdk不会弹出默认的通知提示，但消息事件照常下发。</p>
<h4 id="_65">获取免打扰列表</h4>
<pre><code>public static void getNoDisturblist(GetNoDisurbListCallback callback)
</code></pre>

<p>参数定义</p>
<ul>
<li>GetNoDisurbListCallback callback 回调接口。</li>
</ul>
<h4 id="_66">免打扰设置</h4>
<p>见api doc中<a href="../im_android_api_docs/cn/jpush/im/android/api/model/UserInfo.html">UserInfo</a>和<a href="../im_android_api_docs/cn/jpush/im/android/api/model/GroupInfo.html">UserInfo</a>相关接口</p>
<h4 id="_67">全局免打扰设置</h4>
<p>设置全局免打扰之后，收到所有消息都将不会有通知栏通知，效果类似<code>setNotificationMode(JMessageClient.NOTI_MODE_NO_NOTIFICATION)</code>，但是此设置在用户换设备之后也会生效。</p>
<pre><code>public static void setNoDisturbGlobal(int noDisturbGlobal, BasicCallback callback)
</code></pre>

<p>参数定义</p>
<ul>
<li>int noDisturbGlobal 全局免打扰标志，1表示设置，其他表示取消设置。</li>
<li>BasicCallback callback 回调接口</li>
</ul>
<h4 id="_68">获取全局免打扰标识</h4>
<pre><code>public static void getNoDisturbGlobal(IntegerCallback callback)
</code></pre>

<p>参数定义</p>
<ul>
<li>IntegerCallback callback 回调接口。</li>
</ul>
<h3 id="_69">跨应用通信</h3>
<p>跨应用通信是指允许同一开发者账号下的不同应用能互相通信，以满足开发者对于不同appKey下应用通信的需求。</br>
JMessage Android SDK在v1.2.0版本中实现了单聊跨应用，v1.3.0版本中实现了群聊以及其他一些功能的跨应用，
具体对应关系见下表：</p>
<table>
    <tr>
        <th>Since</th>
        <th>实现功能</th>
        <th>说明</th>
    </tr>
    <tr>
        <td>v1.2.0</td>
        <td>1.跨应用获取用户信息<br>2.跨应用单聊</td>
        <td>1.实现跨应用获取用户信息<br>2.实现跨应用给用户发送单聊消息</td>
    </tr>
    <tr>
        <td>v1.3.0</td>
        <td>1.跨应用群聊<br>2.跨应用黑名单设置<br>3.跨应用免打扰设置</td>
        <td>1.群组中允许加入来自不同应用下的用户，使跨应用群聊成为可能*<br>2.允许跨应用加用户至黑名单，以屏蔽来自不同应用下用户的消息<br>3. 实现跨应用添加和移除免打扰</td>
    </tr>   
</table>

<p>*<em>：实现跨应用群聊的关键在于群组中加入跨应用的群成员，而创建会话和发送消息的流程和普通的群聊实现方式一致。</em></p>
<h4 id="_70">跨应用相关接口摘要</h4>
<p>详细接口说明请前往极光IM <a href="../im_android_api_docs/">Android API Java docs</a></p>
<h6 id="conversation">Conversation</h6>
<p>创建单聊跨应用会话</p>
<pre><code>createSingleConversation(String userName, String appKey)
</code></pre>

<h6 id="jmessageclient">JMessageClient</h6>
<p>跨应用获取用户信息</p>
<pre><code>getUserInfo(String username,String appKey,GetUserInfoCallback callback)  
</code></pre>

<p>跨应用添加群成员</p>
<pre><code>addGroupMembers(long groupID,String appKey,List&lt;String&gt; userNameList,BasicCallback callback)            
</code></pre>

<p>跨应用踢出群成员</p>
<pre><code>removeGroupMembers(long groupID,String appKey,List&lt;String&gt; userNameList,BasicCallback callback)
</code></pre>

<p>跨应用添加user进黑名单</p>
<pre><code>addUsersToBlacklist(List&lt;String&gt; usernames,String appKey,BasicCallback callback)  
</code></pre>

<p>跨应用将user移出黑名单</p>
<pre><code>delUsersFromBlacklist(List&lt;String&gt; usernames,String appKey,BasicCallback callback)  
</code></pre>

<h6 id="groupinfo">GroupInfo</h6>
<p>获取群成员信息</p>
<pre><code>getGroupMemberInfo(String username, String appKey)  
</code></pre>

<h4 id="_71">跨应用相关具体实现</h4>
<h5 id="_72">跨应用获取用户信息</h5>
<p>通过指定appKey可以实现获取跨应用用户信息。</p>
<pre><code>JMessageClient.getUserInfo(java.lang.String username,java.lang.String appKey,GetUserInfoCallback callback)
</code></pre>

<p>参数定义:</p>
<ul>
<li>username - 开发者注册的用户名</li>
<li>appKey - 指定的appKey,如果为空则在本应用appKey下查找用户</li>
<li>callback - 获取用户信息的回调接口</li>
</ul>
<p>代码示例：</p>
<pre><code>JMessageClient.getUserInfo(&quot;username&quot;, &quot;appKey&quot;, new GetUserInfoCallback() {
     @Override
     public void gotResult(int responseCode, String responseMessage, UserInfo info) {
         // 获取到跨应用的用户信息
         ...
    }
});
</code></pre>

<h5 id="_73">跨应用单聊实现</h5>
<p>创建单聊会话时指定对方用户所属appKey，即可建立起一个和跨应用用户的单聊会话。</p>
<pre><code>Conversation.createSingleConversation(String targetUsername, String appKey)
</code></pre>

<p>参数定义：</p>
<ul>
<li>targetUsername - 用户的username</li>
<li>appKey - 指定的appKey,如果为空则默认填本应用appKey</li>
</ul>
<p>创建跨应用会话后，创建消息发送即可。下面以创建一条单聊文本消息为例</p>
<p>代码示例：</p>
<pre><code>//创建跨应用会话
Conversation con = Conversation.createSingleConversation(&quot;username&quot;, &quot;appKey&quot;);
MessageContent content = new TextContent(&quot;hello&quot;);
//创建一条消息 
Message message = con.createSendMessage(content);
//发送消息 
JMessageClient.sendMessage(message);
</code></pre>

<h5 id="_74">跨应用群聊实现</h5>
<p>实现跨应用群聊的关键在于群组中加入跨应用的群成员，而创建会话和发送消息的流程和普通的群聊实现方式一致。</p>
<p>下面列出了和跨应用操作群成员相关的接口</p>
<p>1.跨应用添加群成员  </p>
<pre><code>JMessageClient.addGroupMembers(long groupID,String appKey,List&lt;String&gt; userNameList,BasicCallback callback);
</code></pre>

<p>参数:</p>
<ul>
<li>groupID - 群组的groupID</li>
<li>appKey - usernameList中user所属的appKey,如果为空则在本应用appKey下查找用户</li>
<li>userNameList - 添加进群组的成员username集合</li>
<li>callback - 回调接口</li>
</ul>
<p>2.跨应用踢出群成员</p>
<pre><code>JMessageClient.removeGroupMembers(long groupID,String appKey,List&lt;String&gt; userNameList,BasicCallback callback);
</code></pre>

<p>参数:</p>
<ul>
<li>groupID - 群组的groupID</li>
<li>appKey - usernameList中user所属的appKey,如果appKey为空则在本应用appKey下查找用户</li>
<li>userNameList - 踢出群组成员的username集合</li>
<li>callback - 回调接口</li>
</ul>
<p>3.获取群成员信息 </p>
<pre><code>//此接口是实例对象上的接口
groupInfo.getGroupMemberInfo(String username, String appKey)
</code></pre>

<p>参数:</p>
<ul>
<li>username - 指定群成员的username </li>
<li>appKey - 群成员所属的appKey</li>
</ul>
<p>下面以向已有群组中添加跨应用群成员，然后创建会话发送消息为例:</p>
<p>代码示例：</p>
<pre><code>//添加跨应用用户到群组
JMessageClient.addGroupMembers(testGid, &quot;appKey&quot;, userNameList, new BasicCallback() {
     @Override
     public void gotResult(int responseCode, String responseMessage) {
         //添加跨应用群成员成功之后，创建会话，发送消息。 
         if(0 == responseCode){
             Conversation conversation = Conversation.createGroupConversation(testGid);
             Message msg = conversation.createSendTextMessage(&quot;hello&quot;);
             JMessageClient.sendMessage(msg);
         }
     }
});
</code></pre>

<h5 id="_75">跨应用添加黑名单实现</h5>
<p>通过以下接口在操作黑名单列表时指定appKey，即可实现将跨应用的用户加入黑名单。</p>
<p>1.添加user进黑名单</p>
<pre><code>JMessageClient.addUsersToBlacklist(List&lt;String&gt; usernames,String appKey,BasicCallback callback);
</code></pre>

<p>参数:</p>
<ul>
<li>usernames -添加进黑名单的username集合</li>
<li>appKey - usernameList中user所属的appKey,如果appKey为空则在本应用appKey下查找用户</li>
<li>callback - 回调接口</li>
</ul>
<p>2.将user移出黑名单</p>
<pre><code>JMessageClient.delUsersFromBlacklist(List&lt;String&gt; usernames,String appKey,BasicCallback callback)
</code></pre>

<p>参数:</p>
<ul>
<li>usernames - 移出黑名单的username集合</li>
<li>appKey - usernameList中user所属的appKey,如果appKey为空则在本应用appKey下查找用户</li>
<li>callback - 回调接口</li>
</ul>
<p>代码示例：</p>
<pre><code>//跨应用添加用户至黑名单
JMessageClient.addUsersToBlacklist(usernames, &quot;appKey&quot;,new BasicCallback() {
     @Override
     public void gotResult(int responseCode, String responseMessage) {
         if (0 == responseCode）{
             //成功跨应用添加用户至黑名单
             ... 
         } 
     }
}); 
</code></pre>

<h5 id="_76">跨应用免打扰实现</h5>
<p>原有接口无需变动。免打扰相关接口是在userinfo对象上的实例接口，也就是说只要获取到的user是跨应用的用户，直接调用该userinfo对象的免打扰接口就可实现跨应用</p>
<pre><code>userinfo.setNoDisturb(int noDisturb,BasicCallback callback)
</code></pre>

<p>参数:</p>
<ul>
<li>noDisturb - 1 -- 免打扰，其他 -- 非免打扰（设置免打扰时将参数设置为1，取消免打扰时将参数设置为0）</li>
<li>callback - 回调接口</li>
</ul>
<p>代码示例：</p>
<pre><code>//跨应用获取用户信息
JMessageClient.getUserInfo(&quot;username&quot;, &quot;appKey&quot;, new GetUserInfoCallback() {
    @Override
    public void gotResult(int responseCode, String responseMessage, UserInfo info) {
        //跨应用获取用户信息成功，设置用户的免打扰属性 
        if(0 == responseCode){
            info.setNoDisturb(1,null);
        }
    }
});
</code></pre>

<h3 id="_77">类定义</h3>
<h4 id="_78">会话与消息</h4>
<pre><code>cn.jpush.im.android.api.model.Conversation

public File getAvatar();
public String getDisplayName();
public Message getLatestMessage();
public List&lt;Message&gt; getAllMessage();
public List&lt;Message&gt; getNewMessagesFromNewest(int offset, int limit);

public Message createSendMessage(MessageContent content);
public Message createSendTextMessage(String text);
public Message createSendImageMessage(File imageFile)
    throws FileNotFoundException
public Message createSendVoiceMessage(File voiceFile, int duration)
    throws FileNotFoundException
public Message createSendCustomMessage(Map&lt;? extends String, ?&gt; valuesMap)
public boolean resetUnreadCount();


</code></pre>

<pre><code>cn.jpush.im.android.api.model.Message

public String getFromID()
public MessageContent getContent()
public ContentType getContentType()
public MessageStatus getStatus()
public String getTargetID()
public long getCreateTime()

public void setOnContentUploadProgressCallback(ProgressUpdateCallback callback)
public void setOnContentDownloadProgressCallback(ProgressUpdateCallback callback)
public void setOnSendCompleteCallback(BasicCallback sendCompleteCallback)

</code></pre>

<p>使用举例</p>
<pre><code>Conversation conv = JMessageClient.getSingleConversation(&quot;tom&quot;);
if (null == conv) {
  conv = Conversation.createSingleConversation(&quot;tom&quot;);
}
TextContent text = new TextContent(&quot;Hi, JMessage!&quot;);
Message message = conv.createSendMessage(text);

JMessageClient.sendMessage(message);
</code></pre>

<h4 id="_79">聊天内容</h4>
<p>聊天内容父类</p>
<pre><code>cn.jpush.im.api.content.MessageContent
</code></pre>
<p>当前支持的聊天内容类型</p>
<pre><code>cn.jpush.im.api.content.TextContent
cn.jpush.im.api.content.VoiceContent
cn.jpush.im.api.content.ImageContent
cn.jpush.im.api.content.LocationContent
cn.jpush.im.api.content.FileContent
cn.jpush.im.api.content.CustomContent
</code></pre>

<p>使用举例</p>
<pre><code>// 参数：文本内容
TextContent text = new TextContent(&quot;Hi, JMessage&quot;);

// 参数：语音文件对象，语音文件时长
VoiceContent voice = new VoiceContent(new File(&quot;/sdcard/voice.amr&quot;), 21);

// 参数：图片文件对象
ImageContent image = new ImageContent(new File(&quot;/sdcard/image.png&quot;));

// 参数：任意文件对象
FileContent fileContent = new FileContent(new File(&quot;/sdcard/file.xxx&quot;));

// 参数：经度，纬度，缩放比例，地址详情
LocationContent locationContent = new LocationContent(111.1,222.2,500,&quot;xx省xx市xx区xx街xx号&quot;);
</code></pre>

<h4 id="_80">回调定义</h4>
<h5 id="basiccallback">BasicCallback</h5>
<pre><code>public abstract class BasicCallback {

    private boolean isRunInUIThread = true;

    /**
     * Default is running in UI thread.
     */
    public BasicCallback() {
    }

    /**
     * 默认callback会在主线程中回调，如果需要在子线程回调，则在构造方法的参数中传入false
     * @param isRunInUIThread 是否在主线程中执行回调，默认为true。
     */
    public BasicCallback(boolean isRunInUIThread) {
        this.isRunInUIThread = isRunInUIThread;
    }

    public boolean isRunInUIThread() {
        return this.isRunInUIThread;
    }

    /**
     * 异步调用返回结果。
     *
     * @param responseCode 0 表示正常。大于 0 表示异常，responseMessage 会有进一步的异常信息。
     * @param responseMessage 一般异常时会有进一步的信息提示。
     */
    public abstract void gotResult(int responseCode, String responseMessage);

}

</code></pre>

<h3 id="_81">错误码定义</h3>
<p>参考文档：<a href="../im_errorcode_android">IM 错误码列表</a></p>
<h3 id="_82">相关文档</h3>
<ul>
<li><a href="../../../../JPush/docs/client/Android/android_guide/">JPush Android SDK 集成指南</a></li>
<li><a href="../../../../JPush/docs/client/Android/android_sdk/">JPush Android SDK 概述</a></li>
<li><a href="../../guideline/jmessage_guide/">极光IM指南</a></li>
<li><a href="../../advanced/im_message_protocol/">IM 消息协议</a></li>
<li><a href="../../advanced/im_objects/">IM 业务对象</a></li>
<li><a href="../../client/im_sdk_ios/">IM SDK for iOS</a></li>
<li><a href="../../server/rest_api_im/">IM REST API</a></li>
</ul> </div>
                        </div> <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../jmessage_android_guide/" class="btn btn-neutral float-right" title="JMessage Android SDK 集成指南">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../guideline/jmessage_guide/" class="btn btn-neutral float-left" title="JMessage 产品简介"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright 2011-2016, jiguang.cn, All Rights Reserved. <br />粤ICP备12056275号-13 深圳市和讯华谷信息技术有限公司</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer> </div>
                </section>
            </div>
            <div class="col-lg-1">
                <div class="visible-lg">
                    <div id="tocright">
                        <div id="navbar-right">
                            <div>
                            <p>目录</p>
                            </div>
                            <ul class="nav" >
    
        
            <li><a href="#_2">消息</a></li>
        
            <li><a href="#_3">用户</a></li>
        
            <li><a href="#_4">群组</a></li>
        
            <li><a href="#_5">好友</a></li>
        
    
        
            <li><a href="#sdk">SDK初始化</a></li>
        
            <li><a href="#_6">注册与登录</a></li>
        
            <li><a href="#_10">用户属性维护</a></li>
        
            <li><a href="#_17">创建消息</a></li>
        
            <li><a href="#_24">发送消息</a></li>
        
            <li><a href="#_25">本地会话管理</a></li>
        
            <li><a href="#_32">事件处理</a></li>
        
            <li><a href="#_35">群组信息维护</a></li>
        
            <li><a href="#_45">黑名单管理</a></li>
        
            <li><a href="#_49">通知栏管理</a></li>
        
            <li><a href="#_56">好友列表管理</a></li>
        
    
        
            <li><a href="#_65">获取免打扰列表</a></li>
        
            <li><a href="#_66">免打扰设置</a></li>
        
            <li><a href="#_67">全局免打扰设置</a></li>
        
            <li><a href="#_68">获取全局免打扰标识</a></li>
        
    
        
            <li><a href="#_70">跨应用相关接口摘要</a></li>
        
            <li><a href="#_71">跨应用相关具体实现</a></li>
        
    
        
            <li><a href="#_78">会话与消息</a></li>
        
            <li><a href="#_79">聊天内容</a></li>
        
            <li><a href="#_80">回调定义</a></li>
        
    
        
    
        
    
    </ul>
    


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</body>

</html>